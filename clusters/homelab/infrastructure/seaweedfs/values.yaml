## SeaweedFS Helm values tailored for this homelab
## Source of truth - ConfigMap in Flux namespace mirrors this for HelmRelease
## Topology: 3 masters (k3s-cp1, k3s-w1, k3s-w2) + 2 volume servers (k3s-w1, k3s-w2)
## Node labels required:
##   - topology.kubernetes.io/rack=rack-{1,2}  (on k3s-w1, k3s-w2)
##   - sw-volume=true  (on k3s-w1, k3s-w2 for volume servers)

global:
  replicationPlacement: "010"  # 1 replica on different rack (works with 2 racks)

master:
  enabled: true
  replicas: 3
  persistence:
    enabled: true
    size: 2Gi
    storageClass: "local-path-provisioner"
  data:
    type: "hostPath"
    hostPathPrefix: /data/seaweed_master
  # Master defaultReplication is hardcoded in chart; patched via kubectl
  defaultReplication: "010"

# Disable single volume server config - use multi-rack volumes instead
volume:
  enabled: false

# Multi-rack volume server configuration
# This creates separate StatefulSets per rack with proper topology
volumes:
  rack1:
    replicas: 1
    rack: "rack-1"
    dataCenter: "dc1"
    nodeSelector: |
      sw-volume: "true"
      topology.kubernetes.io/rack: rack-1
    dataDirs:
      - name: data
        type: hostPath
        hostPathPrefix: /data/seaweed
        maxVolumes: 100
  rack2:
    replicas: 1
    rack: "rack-2"
    dataCenter: "dc1"
    nodeSelector: |
      sw-volume: "true"
      topology.kubernetes.io/rack: rack-2
    dataDirs:
      - name: data
        type: hostPath
        hostPathPrefix: /data/seaweed
        maxVolumes: 100

filer:
  enabled: true
  replicas: 1  # Start with 1 filer using LevelDB; upgrade to 2+ with MySQL backend
  persistence:
    enabled: true
    size: 2Gi
    storageClass: "local-path-provisioner"
  data:
    type: "hostPath"
    hostPathPrefix: /data/seaweed_filer
  # Disable MySQL by default for LevelDB mode
  extraEnvironmentVars:
    WEED_MYSQL_ENABLED: "false"

csi:
  driver:
    enabled: true
  controller:
    replicas: 1
  node:
    enabled: true

# Conservative resource limits for homelab; adjust for your nodes
resources:
  master:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  filer:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  volume:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
