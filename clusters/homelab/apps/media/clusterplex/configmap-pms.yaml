apiVersion: v1
kind: ConfigMap
metadata:
  name: clusterplex-pms-config
  namespace: media
  labels:
    app.kubernetes.io/name: clusterplex-pms-config
    app.kubernetes.io/part-of: clusterplex
data:
  VERSION: docker
  TZ: America/Chicago
  PUID: "1000"
  PGID: "1000"
  DOCKER_MODS: ghcr.io/pabloromeo/clusterplex_dockermod:latest
  ORCHESTRATOR_URL: http://clusterplex-orchestrator:3500
  PMS_SERVICE: clusterplex-pms
  PMS_PORT: "32400"
  TRANSCODER_VERBOSE: "1"
  TRANSCODE_OPERATING_MODE: both
  LOCAL_RELAY_ENABLED: "1"
  LOCAL_RELAY_PORT: "32499"
  # Tell Plex it lives behind a reverse proxy at this URL.
  # Required so Plex registers the correct address with plex.tv for relay/remote access.
  ADVERTISE_IP: "https://plex.homelab:443,http://plex.homelab:80"
  # secureConnections=0 → "Disabled" (no internal HTTP→HTTPS redirect).
  # Traefik handles TLS termination; Plex should not redirect clients itself.
  # Without this, Plex sees X-Forwarded-Proto:https and redirects, causing an infinite loop.
  PLEX_PREFERENCE_secureConnections: "0"
  # Force hardware-accelerated encoding even though PMS node has no GPU.
  # PMS passes encode flags; the actual transcoding happens on the GPU worker.
  PLEX_PREFERENCE_HardwareAcceleratedCodecs: "1"
  PLEX_PREFERENCE_HardwareDevicePath: "/dev/dri/renderD128"
