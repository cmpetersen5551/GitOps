apiVersion: v1
kind: ConfigMap
metadata:
  name: clusterplex-worker-config
  namespace: media
  labels:
    app.kubernetes.io/name: clusterplex-worker-config
    app.kubernetes.io/part-of: clusterplex
data:
  VERSION: docker
  TZ: America/Chicago
  PUID: "1000"
  PGID: "1000"
  # Plex bundles libva and includes VA driver code compiled in. We rely on Plex's internal
  # driver paths and don't install system packages. Instead, ensure /dev/dri is mounted
  # with correct permissions (supplementalGroups=992 for render group, set in StatefulSet).
  # Hardware ENCODE (h264_vaapi, hevc_vaapi) will work via Plex UI setting:
  #   Settings → Transcoder → "Use hardware acceleration when available"
  DOCKER_MODS: ghcr.io/pabloromeo/clusterplex_worker_dockermod:latest
  LIBVA_DRIVER_NAME: iHD
  LIBVA_DRIVERS_PATH: /usr/lib/x86_64-linux-gnu/dri
  ORCHESTRATOR_URL: http://clusterplex-orchestrator:3500
  LISTENING_PORT: "3501"
  STAT_CPU_INTERVAL: "10000"
  EAE_SUPPORT: "1"
  # Inject -hwaccel vaapi for hardware decode. Hardware encode (h264_vaapi) is driven
  # by PMS Preferences.xml HardwareAcceleratedCodecs=1 — set directly in the PVC.
  FFMPEG_HWACCEL: vaapi
