apiVersion: v1
kind: ConfigMap
metadata:
  name: clusterplex-worker-config
  namespace: media
  labels:
    app.kubernetes.io/name: clusterplex-worker-config
    app.kubernetes.io/part-of: clusterplex
data:
  VERSION: docker
  TZ: America/Chicago
  PUID: "1000"
  PGID: "1000"
  # universal-package-install installs intel-media-va-driver which provides iHD_drv_video.so —
  # required for Plex's VAAPI encoder (h264_vaapi / hevc_vaapi are compiled in) to access
  # /dev/dri/renderD128. Plex Transcoder is built with --disable-hwaccels so hardware DECODE
  # via -hwaccel flags doesn't work; FFMPEG_HWACCEL must be unset. Hardware ENCODE via VAAPI
  # (software decode → hardware encode) does work and is triggered by enabling hardware
  # transcoding in Plex UI settings.
  DOCKER_MODS: ghcr.io/pabloromeo/clusterplex_worker_dockermod:latest|lscr.io/linuxserver/mods:universal-package-install
  INSTALL_PACKAGES: i965-va-driver libva-drm2
  LIBVA_DRIVER_NAME: i965
  ORCHESTRATOR_URL: http://clusterplex-orchestrator:3500
  LISTENING_PORT: "3501"
  STAT_CPU_INTERVAL: "10000"
  EAE_SUPPORT: "1"
  # FFMPEG_HWACCEL intentionally unset — Plex Transcoder's custom ffmpeg build does not
  # include h264_qsv/hevc_qsv/h264_vaapi-decode hwaccels. Setting this causes a fatal
  # "Device creation failed: -12" and exit code 244. Hardware acceleration is provided by
  # Plex's internal VAAPI encode path (controlled via Plex UI → Settings → Transcoder).
